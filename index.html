<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Enhanced Lecanemab Digital Companion - Track your brain health, mood, symptoms, and lifestyle">
    <meta name="theme-color" content="#0ea5e9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Lecanemab Companion">
    <link rel="manifest" href="manifest.json">
    <title>Lecanemab Digital Companion - Enhanced App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
            color: #0f172a;
            line-height: 1.6;
        }

        .app-container {
            max-width: min(100vw, 450px);
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 30px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
        }

        /* Screen Management */
        .screen {
            display: none;
            min-height: 100vh;
            animation: slideIn 0.3s ease-out;
        }

        .screen.active {
            display: block;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Navigation Bar */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: min(100vw, 450px);
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            padding: 8px 0;
            z-index: 100;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 8px 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
            margin: 0 4px;
        }

        .nav-item.active {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 10px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            padding: 60px 24px 24px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #10b981, #0ea5e9, #8b5cf6);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
            letter-spacing: -0.5px;
        }

        .header-subtitle {
            font-size: 14px;
            opacity: 0.9;
            font-weight: 500;
        }

        .content {
            padding: 24px;
            margin-bottom: 80px;
        }

        /* Common Components */
        .btn {
            width: 100%;
            padding: 18px 24px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 16px;
            position: relative;
            overflow: hidden;
        }

        .btn:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 20px;
            padding: 24px;
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
            max-height: 80vh;
            overflow-y: auto;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: scale(0.9) translateY(-20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .modal-close:hover {
            background-color: #f1f5f9;
        }

        .modal-close:focus {
            outline: 2px solid #3b82f6;
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            z-index: 300;
            display: none;
            animation: notificationSlide 0.3s ease-out;
            max-width: 90vw;
        }

        @keyframes notificationSlide {
            from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        /* Progress Ring */
        .progress-ring {
            width: 120px;
            height: 120px;
            position: relative;
            margin: 0 auto 20px;
        }

        .progress-ring-bg {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #e2e8f0 0deg 360deg);
        }

        .progress-ring-fill {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #10b981 0deg var(--progress, 252deg), transparent var(--progress, 252deg) 360deg);
            transition: all 0.5s ease;
        }

        .progress-ring-inner {
            position: absolute;
            top: 15px;
            left: 15px;
            width: calc(100% - 30px);
            height: calc(100% - 30px);
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        /* Enhanced Card Styles */
        .metric-card {
            background: linear-gradient(135deg, #fff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 28px rgba(0,0,0,0.12);
        }

        .metric-value {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-label {
            font-size: 14px;
            color: #64748b;
            font-weight: 600;
        }

        /* Timeline Styles */
        .timeline {
            position: relative;
            padding-left: 24px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #3b82f6, #10b981);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 24px;
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #3b82f6;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #3b82f6;
        }

        /* Smart Alert Styles */
        .alert {
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
        }

        .alert-info {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border: 1px solid #3b82f6;
            color: #1e40af;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border: 1px solid #f59e0b;
            color: #92400e;
        }

        .alert-success {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border: 1px solid #10b981;
            color: #065f46;
        }

        .alert-danger {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border: 1px solid #ef4444;
            color: #991b1b;
        }

        .alert-icon {
            font-size: 24px;
            margin-right: 12px;
        }

        /* Mood Selector */
        .mood-selector {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .mood-day {
            aspect-ratio: 1;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #e2e8f0;
            background: #f8fafc;
        }

        .mood-day:hover {
            transform: scale(1.05);
        }

        .mood-day:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }

        .mood-day.selected {
            border-color: #3b82f6;
            background: #dbeafe;
            color: #1e40af;
        }

        .mood-emoji {
            font-size: 20px;
            margin-bottom: 4px;
        }

        /* Symptom Grid */
        .symptom-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .symptom-item {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .symptom-item:hover {
            transform: translateY(-2px);
        }

        .symptom-item:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }

        .symptom-item.selected {
            background: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }

        .symptom-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .symptom-label {
            font-size: 14px;
            font-weight: 600;
        }

        /* Chart Styles */
        .chart-container {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .chart-canvas {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Lifestyle Tracker */
        .lifestyle-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .lifestyle-item {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .lifestyle-item:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }

        .lifestyle-item.completed {
            background: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }

        .lifestyle-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .lifestyle-label {
            font-size: 14px;
            font-weight: 600;
        }

        /* Utility Classes */
        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .fab {
            position: fixed;
            bottom: 90px;
            right: 24px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
            transition: all 0.3s ease;
            z-index: 50;
        }

        .fab:focus {
            outline: 2px solid #10b981;
            outline-offset: 2px;
        }

        .emergency-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            animation: pulse 2s infinite;
        }

        /* Loading Spinner */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Weekly Report Styles */
        .weekly-report {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .report-score {
            font-size: 32px;
            font-weight: 800;
            color: #0ea5e9;
        }

        .report-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .report-item:last-child {
            border-bottom: none;
        }

        /* Screen reader only text */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Responsive Adjustments */
        @media (max-width: 450px) {
            .content {
                padding: 16px;
            }
            
            .header {
                padding: 50px 16px 20px;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Screen 1: Enhanced Brain Health Assessment -->
        <div class="screen active" id="screen-1">
            <div class="header">
                <h1>Brain Health Assessment</h1>
                <div class="header-subtitle">Track Your Cognitive Wellness</div>
            </div>

            <div class="content">
                <div class="alert alert-info">
                    <div class="alert-icon" aria-hidden="true">🎯</div>
                    <div>
                        <strong>Personalized Insights Ready!</strong><br>
                        Based on your recent data, we have tailored recommendations for you.
                    </div>
                </div>

                <div class="progress-ring">
                    <div class="progress-ring-bg"></div>
                    <div class="progress-ring-fill" style="--progress: 252deg;"></div>
                    <div class="progress-ring-inner">
                        <div style="font-size: 24px; font-weight: 800; color: #10b981;">70%</div>
                        <div style="font-size: 12px; color: #64748b;">Overall Score</div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                    <div class="metric-card">
                        <div class="metric-value">85%</div>
                        <div class="metric-label">Memory</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">78%</div>
                        <div class="metric-label">Attention</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">82%</div>
                        <div class="metric-label">Executive Function</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">74%</div>
                        <div class="metric-label">Processing Speed</div>
                    </div>
                </div>

                </button>
                <button class="btn btn-secondary" onclick="startComprehensiveTest()">
                    🧩 Comprehensive Cognitive Test (ReCOGnAIze)
                </button>

                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">💊 Treatment Status</h3>
                    <div class="medication-status">
                        <!-- Medication status will be populated by JavaScript -->
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">📊 Assessment History</h3>
                    <div class="timeline">
                        <div class="timeline-item">
                            <div style="font-weight: 600; color: #1e293b;">Latest Assessment</div>
                            <div style="font-size: 14px; color: #64748b;">May 15, 2025 • Score: 70%</div>
                            <div style="font-size: 12px; color: #10b981; margin-top: 4px;">↗️ +5% improvement</div>
                        </div>
                        <div class="timeline-item">
                            <div style="font-weight: 600; color: #1e293b;">Previous Assessment</div>
                            <div style="font-size: 14px; color: #64748b;">April 30, 2025 • Score: 65%</div>
                        </div>
                    </div>
                </div>

                <button class="btn" style="background: white; color: #6366f1; border: 2px solid #6366f1;" onclick="shareProgress()">
                    📤 Share Progress with Care Team
                </button>
            </div>
        </div>

        <!-- Screen 2: Enhanced Mood & Symptom Tracking -->
        <div class="screen" id="screen-2">
            <div class="header">
                <h1>Mood & Symptom Tracker</h1>
                <div class="header-subtitle">Monitor Your Daily Well-being</div>
            </div>

            <div class="content">
                <div class="alert alert-info">
                    <div class="alert-icon" aria-hidden="true">📊</div>
                    <div>
                        <strong>Weekly Check-in</strong><br>
                        Track your mood over the past 7 days and report any symptoms.
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">📅 How has your mood been in the past 7 days?</h3>
                    <div class="mood-selector" id="moodSelector" role="group" aria-label="Weekly mood tracker">
                        <button class="mood-day" data-day="0" onclick="selectMood(0)" aria-label="Monday mood">
                            <div class="mood-emoji" aria-hidden="true">😊</div>
                            <div>Mon</div>
                        </button>
                        <button class="mood-day" data-day="1" onclick="selectMood(1)" aria-label="Tuesday mood">
                            <div class="mood-emoji" aria-hidden="true">🙂</div>
                            <div>Tue</div>
                        </button>
                        <button class="mood-day" data-day="2" onclick="selectMood(2)" aria-label="Wednesday mood">
                            <div class="mood-emoji" aria-hidden="true">😐</div>
                            <div>Wed</div>
                        </button>
                        <button class="mood-day" data-day="3" onclick="selectMood(3)" aria-label="Thursday mood">
                            <div class="mood-emoji" aria-hidden="true">😊</div>
                            <div>Thu</div>
                        </button>
                        <button class="mood-day" data-day="4" onclick="selectMood(4)" aria-label="Friday mood">
                            <div class="mood-emoji" aria-hidden="true">🙂</div>
                            <div>Fri</div>
                        </button>
                        <button class="mood-day" data-day="5" onclick="selectMood(5)" aria-label="Saturday mood">
                            <div class="mood-emoji" aria-hidden="true">😊</div>
                            <div>Sat</div>
                        </button>
                        <button class="mood-day" data-day="6" onclick="selectMood(6)" aria-label="Sunday mood">
                            <div class="mood-emoji" aria-hidden="true">😐</div>
                            <div>Sun</div>
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">⚠️ Symptoms & Side Effects</h3>
                    <p style="font-size: 14px; color: #64748b; margin-bottom: 16px;">Select any symptoms you've experienced this week:</p>
                    
                    <div class="symptom-grid" role="group" aria-label="Symptom selection">
                        <button class="symptom-item" data-symptom="headache" onclick="toggleSymptom(this)" tabindex="0">
                            <div class="symptom-icon" aria-hidden="true">🤕</div>
                            <div class="symptom-label">Headache</div>
                        </button>
                        <button class="symptom-item" data-symptom="nausea" onclick="toggleSymptom(this)" tabindex="0">
                            <div class="symptom-icon" aria-hidden="true">🤢</div>
                            <div class="symptom-label">Nausea</div>
                        </button>
                        <button class="symptom-item" data-symptom="dizziness" onclick="toggleSymptom(this)" tabindex="0">
                            <div class="symptom-icon" aria-hidden="true">😵‍💫</div>
                            <div class="symptom-label">Dizziness</div>
                        </button>
                        <button class="symptom-item" data-symptom="confusion" onclick="toggleSymptom(this)" tabindex="0">
                            <div class="symptom-icon" aria-hidden="true">😵</div>
                            <div class="symptom-label">Confusion</div>
                        </button>
                        <button class="symptom-item" data-symptom="fever" onclick="toggleSymptom(this)" tabindex="0">
                            <div class="symptom-icon" aria-hidden="true">🤒</div>
                            <div class="symptom-label">Fever</div>
                        </button>
                        <button class="symptom-item" data-symptom="vision" onclick="toggleSymptom(this)" tabindex="0">
                            <div class="symptom-icon" aria-hidden="true">👁️</div>
                            <div class="symptom-label">Vision Changes</div>
                        </button>
                        <button class="symptom-item" data-symptom="breathing" onclick="toggleSymptom(this)" tabindex="0">
                            <div class="symptom-icon" aria-hidden="true">😮‍💨</div>
                            <div class="symptom-label">Breathing Issues</div>
                        </button>
                        <button class="symptom-item" data-symptom="fatigue" onclick="toggleSymptom(this)" tabindex="0">
                            <div class="symptom-icon" aria-hidden="true">😴</div>
                            <div class="symptom-label">Fatigue</div>
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">🏃‍♀️ Lifestyle Tracking</h3>
                    <div class="lifestyle-grid" role="group" aria-label="Lifestyle activities">
                        <button class="lifestyle-item" onclick="toggleLifestyle(this)" data-activity="exercise" tabindex="0">
                            <div class="lifestyle-icon" aria-hidden="true">🏋️‍♀️</div>
                            <div class="lifestyle-label">Exercise</div>
                        </button>
                        <button class="lifestyle-item" onclick="toggleLifestyle(this)" data-activity="sleep" tabindex="0">
                            <div class="lifestyle-icon" aria-hidden="true">😴</div>
                            <div class="lifestyle-label">Good Sleep</div>
                        </button>
                        <button class="lifestyle-item" onclick="toggleLifestyle(this)" data-activity="hydration" tabindex="0">
                            <div class="lifestyle-icon" aria-hidden="true">💧</div>
                            <div class="lifestyle-label">Hydration</div>
                        </button>
                        <button class="lifestyle-item" onclick="toggleLifestyle(this)" data-activity="nutrition" tabindex="0">
                            <div class="lifestyle-icon" aria-hidden="true">🥗</div>
                            <div class="lifestyle-label">Healthy Diet</div>
                        </button>
                    </div>
                </div>

                <button class="btn btn-success" onclick="submitWeeklyReport()">
                    📊 Submit Weekly Report
                </button>
            </div>
        </div>

        <!-- Screen 3: Enhanced Appointments with Smart Features -->
        <div class="screen" id="screen-3">
            <div class="header">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px;">
                    <div>
                        <h1>Smart Calendar</h1>
                        <div class="header-subtitle">AI-Powered Scheduling</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 8px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">Week 24</div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                    <div class="metric-card" style="background: rgba(255,255,255,0.15); border: none; color: white;">
                        <div class="metric-value" style="color: white;">12</div>
                        <div class="metric-label" style="color: rgba(255,255,255,0.8);">Infusions</div>
                    </div>
                    <div class="metric-card" style="background: rgba(255,255,255,0.15); border: none; color: white;">
                        <div class="metric-value" style="color: white;">4</div>
                        <div class="metric-label" style="color: rgba(255,255,255,0.8);">MRIs</div>
                    </div>
                    <div class="metric-card" style="background: rgba(255,255,255,0.15); border: none; color: white;">
                        <div class="metric-value" style="color: white;">98%</div>
                        <div class="metric-label" style="color: rgba(255,255,255,0.8);">Adherence</div>
                    </div>
                </div>
            </div>

            <div class="content">
                <div class="alert alert-success">
                    <div class="alert-icon" aria-hidden="true">🤖</div>
                    <div>
                        <strong>Smart Scheduling Active</strong><br>
                        AI has optimized your next appointment based on your preferences and symptoms.
                    </div>
                </div>

                <div class="card pulse" style="border-color: #10b981; background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);">
                    <div style="display: flex; align-items: center; margin-bottom: 16px;">
                        <div id="countdownTimer" style="background: #10b981; color: white; padding: 8px 16px; border-radius: 20px; font-weight: 700; font-size: 14px;">2 days 14 hours</div>
                        <div style="margin-left: 12px; font-weight: 700; color: #065f46;">Next: Lecanemab Infusion</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; font-size: 14px; color: #065f46; margin-bottom: 16px;">
                        <div><span style="margin-right: 8px;" aria-hidden="true">📅</span>Friday, May 31</div>
                        <div><span style="margin-right: 8px;" aria-hidden="true">🕐</span>10:30 AM</div>
                        <div><span style="margin-right: 8px;" aria-hidden="true">🏥</span>Mayo Clinic</div>
                        <div><span style="margin-right: 8px;" aria-hidden="true">👩‍⚕️</span>Dr. Martinez</div>
                    </div>

                    <button class="btn btn-success" style="margin: 0;" onclick="addToCalendar()">
                        📱 Add to Device Calendar
                    </button>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">🚗 Travel Assistant</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                        <div>
                            <div style="font-size: 14px; color: #64748b;">Travel Time</div>
                            <div style="font-size: 16px; font-weight: 700; color: #1e293b;">25 mins</div>
                        </div>
                        <div>
                            <div style="font-size: 14px; color: #64748b;">Leave By</div>
                            <div style="font-size: 16px; font-weight: 700; color: #1e293b;">10:05 AM</div>
                        </div>
                    </div>
                    <button class="btn btn-secondary" style="margin: 0;" onclick="getDirections()">
                        🗺️ Get Live Directions
                    </button>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">📋 Smart Pre-Visit Checklist</h3>
                    <div id="checklistItems"></div>
                    <div style="margin-top: 12px; font-size: 12px; color: #10b981;">✅ All items completed!</div>
                </div>
            </div>

            <button class="fab" onclick="showAppointmentModal()" aria-label="Schedule new appointment">+</button>
        </div>

        <!-- Screen 4: Advanced Progress Dashboard with Mood Trends -->
        <div class="screen" id="screen-4">
            <div class="header">
                <h1>Progress Intelligence</h1>
                <div class="header-subtitle">AI-Powered Insights & Trends</div>
            </div>

            <div class="content">
                <div class="alert alert-success">
                    <div class="alert-icon" aria-hidden="true">📈</div>
                    <div>
                        <strong>Trending Positive!</strong><br>
                        Your cognitive scores show a 15% improvement over 3 months.
                    </div>
                </div>

                <div class="chart-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="color: #1e293b;">🧠 Cognitive Trends</h3>
                        <label for="chartTimeframe" class="sr-only">Select timeframe</label>
                        <select id="chartTimeframe" onchange="updateChart()" style="padding: 6px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 12px;">
                            <option value="3months">Last 3 Months</option>
                            <option value="6months">Last 6 Months</option>
                            <option value="1year">Last Year</option>
                        </select>
                    </div>
                    <div class="chart-canvas" id="cognitiveChart">
                        <div style="text-align: center; color: #64748b;">
                            <div style="font-size: 18px; font-weight: 700; color: #10b981; margin-bottom: 8px;">+15%</div>
                            <div style="font-size: 14px;">Cognitive Improvement</div>
                            <div style="font-size: 12px; margin-top: 4px;">Interactive chart loading...</div>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="color: #1e293b;">😊 Mood & Behavior Trends</h3>
                        <span style="font-size: 12px; color: #64748b;">Weekly Average</span>
                    </div>
                    <div class="chart-canvas" id="moodChart">
                        <div style="text-align: center; color: #64748b;">
                            <div style="font-size: 18px; font-weight: 700; color: #3b82f6; margin-bottom: 8px;">Good</div>
                            <div style="font-size: 14px;">Overall Mood This Week</div>
                            <div style="font-size: 12px; margin-top: 4px;">Interactive chart loading...</div>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                    <div class="metric-card">
                        <div class="metric-value">92%</div>
                        <div class="metric-label">Treatment Adherence</div>
                        <div style="font-size: 12px; color: #10b981; margin-top: 4px;">↗️ Above target</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">2</div>
                        <div class="metric-label">Symptoms Reported</div>
                        <div style="font-size: 12px; color: #f59e0b; margin-top: 4px;">This week</div>
                    </div>
                </div>

                <div class="weekly-report">
                    <div class="report-header">
                        <h3 style="color: #1e293b;">📊 Weekly Lifestyle Report</h3>
                        <div class="report-score">85%</div>
                    </div>
                    <div class="report-item">
                        <span>🏋️‍♀️ Exercise</span>
                        <span style="color: #10b981; font-weight: 600;">5/7 days</span>
                    </div>
                    <div class="report-item">
                        <span>😴 Good Sleep</span>
                        <span style="color: #10b981; font-weight: 600;">6/7 nights</span>
                    </div>
                    <div class="report-item">
                        <span>💧 Hydration</span>
                        <span style="color: #3b82f6; font-weight: 600;">7/7 days</span>
                    </div>
                    <div class="report-item">
                        <span>🥗 Healthy Diet</span>
                        <span style="color: #f59e0b; font-weight: 600;">4/7 days</span>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">🤖 AI Insights</h3>
                    <div style="background: #f8fafc; padding: 16px; border-radius: 12px; border-left: 4px solid #3b82f6;">
                        <div style="font-size: 14px; color: #1e293b; line-height: 1.6;">
                            Your mood correlates positively with exercise days. Consider maintaining your current exercise routine of 5+ days per week for optimal cognitive benefits.
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="exportDetailedReport()">
                    📊 Export Comprehensive Report
                </button>
            </div>
        </div>

        <!-- Screen 5: Enhanced Education Hub -->
        <div class="screen" id="screen-5">
            <div class="header">
                <h1>Learning Center</h1>
                <div class="header-subtitle">Personalized Education</div>
            </div>

            <div class="content">
                <div class="alert alert-info">
                    <div class="alert-icon" aria-hidden="true">💡</div>
                    <div>
                        <strong>Recommended for You</strong><br>
                        Based on your progress, we suggest learning about ARIA monitoring.
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">🎯 Your Learning Path</h3>
                    <div style="display: flex; align-items: center; margin-bottom: 12px;">
                        <div style="width: 100%; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                            <div style="width: 65%; height: 100%; background: linear-gradient(90deg, #3b82f6, #1e40af);"></div>
                        </div>
                        <span style="margin-left: 12px; font-size: 14px; font-weight: 600; color: #3b82f6;">65%</span>
                    </div>
                    <div style="font-size: 14px; color: #64748b;">3 of 5 modules completed</div>
                </div>

                <div style="display: grid; gap: 16px; margin-bottom: 24px;">
                    <button class="video-card" onclick="playInteractiveVideo('aria')" style="background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.08); transition: all 0.3s ease; cursor: pointer; border: none; text-align: left; width: 100%;">
                        <div style="height: 120px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; position: relative;">
                            <span aria-hidden="true">🧠</span>
                            <div style="position: absolute; width: 48px; height: 48px; background: rgba(255,255,255,0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #ef4444; font-size: 20px;" aria-hidden="true">▶️</div>
                            <div style="position: absolute; top: 12px; right: 12px; background: #f59e0b; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">New</div>
                        </div>
                        <div style="padding: 16px;">
                            <div style="font-size: 16px; font-weight: 700; margin-bottom: 8px; color: #1e293b;">Understanding ARIA</div>
                            <div style="font-size: 14px; color: #64748b; line-height: 1.5;">Learn about Amyloid Related Imaging Abnormalities and monitoring</div>
                            <div style="font-size: 12px; color: #94a3b8; margin-top: 8px;">Duration: 6:45 • Interactive content</div>
                        </div>
                    </button>

                    <button class="video-card" onclick="playInteractiveVideo('lifestyle')" style="background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.08); transition: all 0.3s ease; cursor: pointer; border: none; text-align: left; width: 100%;">
                        <div style="height: 120px; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; position: relative;">
                            <span aria-hidden="true">🏃‍♀️</span>
                            <div style="position: absolute; width: 48px; height: 48px; background: rgba(255,255,255,0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fa709a; font-size: 20px;" aria-hidden="true">▶️</div>
                            <div style="position: absolute; top: 12px; right: 12px; background: #10b981; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">Recommended</div>
                        </div>
                        <div style="padding: 16px;">
                            <div style="font-size: 16px; font-weight: 700; margin-bottom: 8px; color: #1e293b;">Brain-Healthy Lifestyle</div>
                            <div style="font-size: 14px; color: #64748b; line-height: 1.5;">Personalized tips based on your progress data</div>
                            <div style="font-size: 12px; color: #94a3b8; margin-top: 8px;">Duration: 8:20 • Interactive exercises included</div>
                        </div>
                    </button>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">📚 Quick Reference</h3>
                    <div style="display: grid; gap: 12px;">
                        <button onclick="openReference('medication-guide')" style="display: flex; align-items: center; padding: 12px; background: #f8fafc; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; border: none; width: 100%; text-align: left;">
                            <div style="width: 32px; height: 32px; background: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; margin-right: 12px;" aria-hidden="true">💊</div>
                            <div>
                                <div style="font-size: 14px; font-weight: 600; color: #1e293b;">Lecanemab Guide</div>
                                <div style="font-size: 12px; color: #64748b;">Dosing, ARIA risks, and monitoring</div>
                            </div>
                        </button>
                        <button onclick="openReference('emergency-contacts')" style="display: flex; align-items: center; padding: 12px; background: #f8fafc; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; border: none; width: 100%; text-align: left;">
                            <div style="width: 32px; height: 32px; background: #ef4444; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; margin-right: 12px;" aria-hidden="true">🚨</div>
                            <div>
                                <div style="font-size: 14px; font-weight: 600; color: #1e293b;">Emergency Contacts</div>
                                <div style="font-size: 12px; color: #64748b;">24/7 support and urgent care</div>
                            </div>
                        </button>
                        <button onclick="openReference('aria-info')" style="display: flex; align-items: center; padding: 12px; background: #f8fafc; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; border: none; width: 100%; text-align: left;">
                            <div style="width: 32px; height: 32px; background: #f59e0b; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; margin-right: 12px;" aria-hidden="true">⚠️</div>
                            <div>
                                <div style="font-size: 14px; font-weight: 600; color: #1e293b;">ARIA Information</div>
                                <div style="font-size: 12px; color: #64748b;">Symptoms and when to seek help</div>
                            </div>
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">🏆 Learning Achievements</h3>
                    <div style="display: flex; justify-content: space-around; text-align: center;">
                        <div>
                            <div style="font-size: 24px; margin-bottom: 4px;" aria-hidden="true">🥇</div>
                            <div style="font-size: 12px; color: #64748b;">Knowledge Expert</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; margin-bottom: 4px;" aria-hidden="true">🎯</div>
                            <div style="font-size: 12px; color: #64748b;">Goal Achiever</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; margin-bottom: 4px;" aria-hidden="true">📚</div>
                            <div style="font-size: 12px; color: #64748b;">Consistent Learner</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Modals -->
        <div class="modal" id="appointmentModal" role="dialog" aria-labelledby="appointmentModalTitle" aria-modal="true">
            <div class="modal-content">
                <button class="modal-close" onclick="closeModal('appointmentModal')" aria-label="Close modal">&times;</button>
                <h2 id="appointmentModalTitle" style="margin-bottom: 20px; color: #1e293b;">Schedule Appointment</h2>
                
                <div style="margin-bottom: 16px;">
                    <label for="appointmentType" style="display: block; font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 8px;">Appointment Type</label>
                    <select id="appointmentType" style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                        <option>Lecanemab Infusion</option>
                        <option>MRI Scan (ARIA Monitoring)</option>
                        <option>Consultation</option>
                        <option>Follow-up</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 16px;">
                    <label for="appointmentDate" style="display: block; font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 8px;">Preferred Date</label>
                    <input type="date" id="appointmentDate" style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label for="appointmentNotes" style="display: block; font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 8px;">Notes</label>
                    <textarea id="appointmentNotes" style="width: 100%; min-height: 80px; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; resize: vertical;" placeholder="Any symptoms or concerns to discuss..."></textarea>
                </div>
                
                <button class="btn btn-primary" onclick="scheduleAppointment()" style="margin: 0;">
                    📅 Request Appointment
                </button>
            </div>
        </div>

        <!-- Symptom Information Modal -->
        <div class="modal" id="symptomInfoModal" role="dialog" aria-labelledby="symptomInfoTitle" aria-modal="true">
            <div class="modal-content">
                <button class="modal-close" onclick="closeModal('symptomInfoModal')" aria-label="Close modal">&times;</button>
                <h2 id="symptomInfoTitle" style="margin-bottom: 20px; color: #1e293b;">Symptom Information</h2>
                <div id="symptomInfoContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Video Modal -->
        <div class="modal" id="videoModal" role="dialog" aria-labelledby="videoModalTitle" aria-modal="true">
            <div class="modal-content" style="max-width: 90%; max-height: 80%;">
                <button class="modal-close" onclick="closeModal('videoModal')" aria-label="Close modal">&times;</button>
                <div id="videoContent">
                    <div style="background: #1e293b; color: white; padding: 20px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 16px;" aria-hidden="true">🎥</div>
                        <h3 id="videoModalTitle" style="margin-bottom: 16px;">Interactive Video Player</h3>
                        <div style="background: rgba(255,255,255,0.1); padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                            <div style="font-size: 14px; margin-bottom: 8px;">Progress: 65%</div>
                            <div style="width: 100%; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden;">
                                <div style="width: 65%; height: 100%; background: #10b981;"></div>
                            </div>
                        </div>
                        <p style="opacity: 0.8; line-height: 1.5;">This would show the interactive video with clickable hotspots, progress tracking, and embedded quizzes.</p>
                        <button class="btn btn-success" onclick="completeVideo()" style="margin-top: 16px;">
                            ✅ Mark as Completed
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification System -->
        <div class="notification" id="notification" role="alert" aria-live="polite">
            <div id="notificationContent"></div>
        </div>

        <!-- Screen 6: Lifestyle Hub -->
        <div class="screen" id="screen-6">
            <div class="header">
                <h1>Lifestyle Hub</h1>
                <div class="header-subtitle">Brain-Healthy Living Made Simple</div>
            </div>

            <div class="content">
                <div class="alert alert-success">
                    <div class="alert-icon" aria-hidden="true">🌟</div>
                    <div>
                        <strong>Great Job This Week!</strong><br>
                        You've completed 85% of your brain-healthy activities. Keep it up!
                    </div>
                </div>

                <!-- Daily Activity Tracker -->
                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">📋 Today's Activities</h3>
                    <div class="lifestyle-grid">
                        <button class="lifestyle-item completed" onclick="toggleDailyActivity(this)" data-activity="exercise" tabindex="0">
                            <div class="lifestyle-icon" aria-hidden="true">🏋️‍♀️</div>
                            <div class="lifestyle-label">Exercise</div>
                            <div style="font-size: 12px; color: #10b981; margin-top: 4px;">✓ 30 mins</div>
                        </button>
                        <button class="lifestyle-item" onclick="toggleDailyActivity(this)" data-activity="meditation" tabindex="0">
                            <div class="lifestyle-icon" aria-hidden="true">🧘‍♀️</div>
                            <div class="lifestyle-label">Meditation</div>
                            <div style="font-size: 12px; color: #64748b; margin-top: 4px;">Goal: 10 mins</div>
                        </button>
                        <button class="lifestyle-item completed" onclick="toggleDailyActivity(this)" data-activity="hydration" tabindex="0">
                            <div class="lifestyle-icon" aria-hidden="true">💧</div>
                            <div class="lifestyle-label">Hydration</div>
                            <div style="font-size: 12px; color: #10b981; margin-top: 4px;">✓ 6/8 glasses</div>
                        </button>
                        <button class="lifestyle-item" onclick="toggleDailyActivity(this)" data-activity="social" tabindex="0">
                            <div class="lifestyle-icon" aria-hidden="true">👥</div>
                            <div class="lifestyle-label">Social Time</div>
                            <div style="font-size: 12px; color: #64748b; margin-top: 4px;">Goal: 30 mins</div>
                        </button>
                    </div>
                </div>

                <!-- Weekly Habit Tracker -->
                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">📊 Weekly Habit Tracker</h3>
                    <div id="habitTracker">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Personalized Tips -->
                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">💡 Personalized Tips</h3>
                    <div id="personalizedTips">
                        <div style="background: #f0f9ff; padding: 16px; border-radius: 12px; border-left: 4px solid #0ea5e9; margin-bottom: 12px;">
                            <div style="font-weight: 600; color: #0c4a6e; margin-bottom: 8px;">🏃‍♀️ Exercise Tip</div>
                            <div style="font-size: 14px; color: #075985; line-height: 1.5;">
                                Great job maintaining your exercise routine! Studies show that 150 minutes of moderate exercise per week can improve cognitive function in Alzheimer's patients.
                            </div>
                        </div>
                        
                        <div style="background: #f0fdf4; padding: 16px; border-radius: 12px; border-left: 4px solid #22c55e; margin-bottom: 12px;">
                            <div style="font-weight: 600; color: #14532d; margin-bottom: 8px;">🥗 Nutrition Tip</div>
                            <div style="font-size: 14px; color: #166534; line-height: 1.5;">
                                Try adding more omega-3 rich foods like salmon, walnuts, and flaxseeds to support brain health during your Lecanemab treatment.
                            </div>
                        </div>
                        
                        <div style="background: #fefce8; padding: 16px; border-radius: 12px; border-left: 4px solid #eab308;">
                            <div style="font-weight: 600; color: #713f12; margin-bottom: 8px;">😴 Sleep Tip</div>
                            <div style="font-size: 14px; color: #a16207; line-height: 1.5;">
                                Aim for 7-9 hours of quality sleep. Poor sleep can affect cognitive performance and may interfere with amyloid clearance.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Brain-Healthy Recipes -->
                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">🍽️ Brain-Healthy Recipes</h3>
                    <div style="display: grid; gap: 12px;">
                        <button onclick="openRecipe('mediterranean-bowl')" style="display: flex; align-items: center; padding: 12px; background: #f8fafc; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; border: none; width: 100%; text-align: left;">
                            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; margin-right: 12px;" aria-hidden="true">🥗</div>
                            <div>
                                <div style="font-size: 14px; font-weight: 600; color: #1e293b;">Mediterranean Bowl</div>
                                <div style="font-size: 12px; color: #64748b;">Rich in omega-3s • 25 mins</div>
                            </div>
                        </button>
                        
                        <button onclick="openRecipe('brain-smoothie')" style="display: flex; align-items: center; padding: 12px; background: #f8fafc; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; border: none; width: 100%; text-align: left;">
                            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; margin-right: 12px;" aria-hidden="true">🫐</div>
                            <div>
                                <div style="font-size: 14px; font-weight: 600; color: #1e293b;">Blueberry Brain Smoothie</div>
                                <div style="font-size: 12px; color: #64748b;">Antioxidant-rich • 5 mins</div>
                            </div>
                        </button>
                        
                        <button onclick="openRecipe('walnut-salmon')" style="display: flex; align-items: center; padding: 12px; background: #f8fafc; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; border: none; width: 100%; text-align: left;">
                            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; margin-right: 12px;" aria-hidden="true">🐟</div>
                            <div>
                                <div style="font-size: 14px; font-weight: 600; color: #1e293b;">Walnut-Crusted Salmon</div>
                                <div style="font-size: 12px; color: #64748b;">High in DHA • 30 mins</div>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Exercise Programs -->
                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">🏃‍♀️ Exercise Programs</h3>
                    <div style="display: grid; gap: 12px;">
                        <button onclick="startExerciseProgram('gentle-yoga')" style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background: linear-gradient(135deg, #ecfdf5, #d1fae5); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; border: 2px solid #10b981; width: 100%; text-align: left;">
                            <div style="display: flex; align-items: center;">
                                <div style="font-size: 24px; margin-right: 12px;" aria-hidden="true">🧘‍♀️</div>
                                <div>
                                    <div style="font-size: 16px; font-weight: 600; color: #065f46;">Gentle Yoga</div>
                                    <div style="font-size: 12px; color: #059669;">15 mins • Beginner friendly</div>
                                </div>
                            </div>
                            <div style="background: #10b981; color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">Start</div>
                        </button>
                        
                        <button onclick="startExerciseProgram('brain-walk')" style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background: linear-gradient(135deg, #fef3c7, #fed7aa); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; border: 2px solid #f59e0b; width: 100%; text-align: left;">
                            <div style="display: flex; align-items: center;">
                                <div style="font-size: 24px; margin-right: 12px;" aria-hidden="true">🚶‍♀️</div>
                                <div>
                                    <div style="font-size: 16px; font-weight: 600; color: #92400e;">Brain-Boosting Walk</div>
                                    <div style="font-size: 12px; color: #d97706;">30 mins • Cognitive exercises included</div>
                                </div>
                            </div>
                            <div style="background: #f59e0b; color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">Start</div>
                        </button>
                    </div>
                </div>

                <!-- Sleep Optimization -->
                <div class="card">
                    <h3 style="margin-bottom: 16px; color: #1e293b;">😴 Sleep Optimization</h3>
                    <div style="background: #f1f5f9; padding: 16px; border-radius: 12px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: 800; color: #3b82f6;">7.2h</div>
                                <div style="font-size: 12px; color: #64748b;">Last Night</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: 800; color: #10b981;">85%</div>
                                <div style="font-size: 12px; color: #64748b;">Sleep Quality</div>
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick="openSleepGuide()" style="margin: 0; font-size: 14px; padding: 12px;">
                            📱 Open Sleep Hygiene Guide
                        </button>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <button class="btn btn-primary" onclick="logQuickActivity()" style="margin: 0; font-size: 14px; padding: 16px;">
                        ➕ Log Activity
                    </button>
                    <button class="btn btn-secondary" onclick="viewWeeklyReport()" style="margin: 0; font-size: 14px; padding: 16px;">
                        📊 Weekly Report
                    </button>
                </div>
            </div>
        </div>

        <!-- Recipe Modal -->
        <div class="modal" id="recipeModal" role="dialog" aria-labelledby="recipeModalTitle" aria-modal="true">
            <div class="modal-content">
                <button class="modal-close" onclick="closeModal('recipeModal')" aria-label="Close modal">&times;</button>
                <h2 id="recipeModalTitle" style="margin-bottom: 20px; color: #1e293b;">Recipe Details</h2>
                <div id="recipeContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav" role="navigation" aria-label="Main navigation">
            <button class="nav-item active" onclick="showScreen(1)" aria-label="Brain Health Assessment">
                <div class="nav-icon" aria-hidden="true">🧠</div>
                <div class="nav-label">Assessment</div>
            </button>
            <button class="nav-item" onclick="showScreen(2)" aria-label="Mood and Symptom Tracker">
                <div class="nav-icon" aria-hidden="true">😊</div>
                <div class="nav-label">Mood</div>
            </button>
            <button class="nav-item" onclick="showScreen(3)" aria-label="Smart Calendar">
                <div class="nav-icon" aria-hidden="true">📅</div>
                <div class="nav-label">Calendar</div>
            </button>
            <button class="nav-item" onclick="showScreen(4)" aria-label="Progress Intelligence">
                <div class="nav-icon" aria-hidden="true">📈</div>
                <div class="nav-label">Progress</div>
            </button>
            <button class="nav-item" onclick="showScreen(5)" aria-label="Learning Center">
                <div class="nav-icon" aria-hidden="true">🎓</div>
                <div class="nav-label">Learn</div>
            </button>
            <button class="nav-item" onclick="showScreen(6)" aria-label="Lifestyle Hub">
                <div class="nav-icon" aria-hidden="true">🌱</div>
                <div class="nav-label">Lifestyle</div>
            </button>
        </nav>

        <!-- Emergency Contact FAB -->
        <button class="fab emergency-btn" onclick="emergencyContact()" style="bottom: 160px;" aria-label="Emergency contact">
            <span aria-hidden="true">🚨</span>
        </button>
    </div>

    <script>
        // Enhanced App State Management with Persistence
        const AppState = {
            currentScreen: 1,
            weeklyMood: [4, 3, 2, 4, 3, 4, 2], // 7 days, 0-4 scale
            selectedSymptoms: [],
            lifestyleActivities: {
                exercise: false,
                sleep: false,
                hydration: false,
                nutrition: false
            },
            userPreferences: {
                notifications: true,
                darkMode: false,
                language: 'en'
            },
            treatmentData: {
                currentWeek: 24,
                nextAppointment: new Date('2025-05-31T10:30:00'),
                adherenceRate: 98,
                infusionCount: 12,
                mriCount: 4,
                lastInfusion: new Date('2025-05-17T10:30:00'),
                nextMRI: new Date('2025-06-14T14:00:00'),
                medications: [
                    {
                        name: 'Lecanemab',
                        dose: '10 mg/kg',
                        frequency: 'Every 2 weeks',
                        nextDue: new Date('2025-05-31T10:30:00'),
                        adherence: 98
                    }
                ]
            },
            cognitiveScores: {
                current: 70,
                baseline: 65,
                trend: 'improving',
                history: [
                    { date: '2025-02-15', score: 65, type: 'baseline' },
                    { date: '2025-03-15', score: 67, type: 'monthly' },
                    { date: '2025-04-15', score: 69, type: 'monthly' },
                    { date: '2025-05-15', score: 70, type: 'monthly' }
                ]
            },
            moodHistory: [],
            symptomHistory: [],
            lifestyleHistory: [],
            streaks: {
                exercise: 5,
                meditation: 2,
                hydration: 7,
                socialTime: 3
            },
            goals: {
                exercise: 5, // days per week
                meditation: 7,
                hydration: 8, // glasses per day
                socialTime: 4 // days per week
            },
            
            // Data persistence methods
            save() {
                try {
                    localStorage.setItem('lecanemabAppState', JSON.stringify(this));
                } catch (error) {
                    console.error('Failed to save app state:', error);
                }
            },
            
            load() {
                try {
                    const saved = localStorage.getItem('lecanemabAppState');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        Object.assign(this, parsed);
                        
                        // Convert date strings back to Date objects
                        this.treatmentData.nextAppointment = new Date(this.treatmentData.nextAppointment);
                        this.treatmentData.lastInfusion = new Date(this.treatmentData.lastInfusion);
                        this.treatmentData.nextMRI = new Date(this.treatmentData.nextMRI);
                        this.treatmentData.medications.forEach(med => {
                            med.nextDue = new Date(med.nextDue);
                        });
                        this.cognitiveScores.history.forEach(entry => {
                            entry.date = new Date(entry.date);
                        });
                    }
                } catch (error) {
                    console.error('Failed to load app state:', error);
                }
            },
            
            // Add data entry methods
            addMoodEntry(date, mood) {
                this.moodHistory.push({ date: new Date(date), mood, timestamp: new Date() });
                this.save();
            },
            
            addSymptomEntry(symptoms) {
                this.symptomHistory.push({ 
                    date: new Date(), 
                    symptoms: [...symptoms], 
                    timestamp: new Date() 
                });
                this.save();
            },
            
            addLifestyleEntry(activities) {
                this.lifestyleHistory.push({ 
                    date: new Date(), 
                    activities: {...activities}, 
                    timestamp: new Date() 
                });
                this.save();
            },
            
            // Analytics methods
            getMoodTrend(days = 30) {
                const cutoff = new Date(Date.now() - days * 24 * 60 * 60 * 1000);
                return this.moodHistory
                    .filter(entry => entry.date > cutoff)
                    .sort((a, b) => a.date - b.date);
            },
            
            getSymptomFrequency(days = 30) {
                const cutoff = new Date(Date.now() - days * 24 * 60 * 60 * 1000);
                const recentSymptoms = this.symptomHistory
                    .filter(entry => entry.date > cutoff)
                    .flatMap(entry => entry.symptoms);
                
                const frequency = {};
                recentSymptoms.forEach(symptom => {
                    frequency[symptom] = (frequency[symptom] || 0) + 1;
                });
                
                return frequency;
            },
            
            getLifestyleStats(days = 7) {
                const cutoff = new Date(Date.now() - days * 24 * 60 * 60 * 1000);
                const recentEntries = this.lifestyleHistory.filter(entry => entry.date > cutoff);
                
                const stats = {
                    exercise: 0,
                    sleep: 0,
                    hydration: 0,
                    nutrition: 0
                };
                
                recentEntries.forEach(entry => {
                    Object.keys(stats).forEach(activity => {
                        if (entry.activities[activity]) {
                            stats[activity]++;
                        }
                    });
                });
                
                return stats;
            }
        };

        // Complete Symptom Information Database (based on Lecanemab prescribing info)
        const symptomInfo = {
            headache: {
                title: "Headache",
                content: `
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #f59e0b; margin-bottom: 8px;">💡 Possible Causes:</h4>
                        <ul style="margin-left: 20px; line-height: 1.6;">
                            <li><strong>Fatigue or stress</strong> - Most common cause</li>
                            <li><strong>ARIA (Amyloid Related Imaging Abnormalities)</strong> - Brain swelling</li>
                            <li><strong>Infusion reaction</strong> - Related to treatment</li>
                        </ul>
                    </div>
                    
                    <div style="background: #fee2e2; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                        <p style="color: #991b1b; font-weight: 600;">⚠️ Seek immediate medical attention if headache:</p>
                        <ul style="margin-left: 20px; color: #991b1b;">
                            <li>Persists for more than 24 hours</li>
                            <li>Is severe or sudden onset</li>
                            <li>Occurs with confusion, vision changes, or dizziness</li>
                        </ul>
                    </div>
                    
                    <button class="btn btn-danger" onclick="emergencyContact()" style="margin: 0;">
                        📞 Contact Care Team
                    </button>
                `
            },
            nausea: {
                title: "Nausea",
                content: `
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #f59e0b; margin-bottom: 8px;">💡 Possible Causes:</h4>
                        <ul style="margin-left: 20px; line-height: 1.6;">
                            <li><strong>Infusion reaction</strong> - Common during/after treatment</li>
                            <li><strong>ARIA</strong> - Associated with brain swelling</li>
                            <li><strong>Other factors</strong> - Diet, medications, anxiety</li>
                        </ul>
                    </div>
                    
                    <div style="background: #fef3c7; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                        <p style="color: #92400e; font-weight: 600;">💡 Management Tips:</p>
                        <ul style="margin-left: 20px; color: #92400e;">
                            <li>Stay hydrated with small sips</li>
                            <li>Eat bland foods if tolerated</li>
                            <li>Rest in a quiet environment</li>
                        </ul>
                    </div>
                    
                    <p style="font-size: 14px; color: #64748b;">Contact your care team if nausea persists or worsens.</p>
                    
                    <button class="btn btn-warning" onclick="reportSymptomToCareTeam('nausea')" style="margin: 0;">
                        📝 Report to Care Team
                    </button>
                `
            },
            dizziness: {
                title: "Dizziness",
                content: `
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #ef4444; margin-bottom: 8px;">⚠️ Possible Causes:</h4>
                        <ul style="margin-left: 20px; line-height: 1.6;">
                            <li><strong>ARIA</strong> - Brain swelling can cause dizziness</li>
                            <li><strong>Blood pressure changes</strong> - During infusion</li>
                            <li><strong>Dehydration</strong> - Especially post-infusion</li>
                        </ul>
                    </div>
                    
                    <div style="background: #fee2e2; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                        <p style="color: #991b1b; font-weight: 600;">🚨 Seek immediate care if dizziness occurs with:</p>
                        <ul style="margin-left: 20px; color: #991b1b;">
                            <li>Severe headache or confusion</li>
                            <li>Vision changes</li>
                            <li>Difficulty walking or weakness</li>
                        </ul>
                    </div>
                    
                    <button class="btn btn-warning" onclick="reportSymptomToCareTeam('dizziness')" style="margin: 0;">
                        📝 Report to Care Team
                    </button>
                `
            },
            confusion: {
                title: "Confusion",
                content: `
                    <div style="margin-bottom: 16px;">
                        <div style="background: #fee2e2; padding: 12px; border-radius: 8px; border-left: 4px solid #ef4444;">
                            <p style="color: #991b1b; font-weight: 700;">🚨 IMPORTANT: Confusion can be a sign of ARIA</p>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #ef4444; margin-bottom: 8px;">⚠️ ARIA Warning Signs:</h4>
                        <ul style="margin-left: 20px; line-height: 1.6; color: #991b1b;">
                            <li>Sudden confusion or disorientation</li>
                            <li>Memory problems beyond baseline</li>
                            <li>Difficulty with familiar tasks</li>
                            <li>Changes in thinking or behavior</li>
                        </ul>
                    </div>
                    
                    <div style="background: #fee2e2; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                        <p style="color: #991b1b; font-weight: 600;">🚨 SEEK IMMEDIATE MEDICAL ATTENTION</p>
                        <p style="color: #991b1b; font-size: 14px;">Confusion can indicate brain swelling (ARIA) which requires urgent evaluation.</p>
                    </div>
                    
                    <button class="btn btn-danger" onclick="emergencyContact()" style="margin: 0;">
                        🚨 Emergency Contact
                    </button>
                `
            },
            fever: {
                title: "Fever",
                content: `
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #f59e0b; margin-bottom: 8px;">💡 Possible Causes:</h4>
                        <ul style="margin-left: 20px; line-height: 1.6;">
                            <li><strong>Infusion reaction</strong> - Immune response to treatment</li>
                            <li><strong>Infection</strong> - Unrelated to treatment</li>
                            <li><strong>Other illness</strong> - Viral or bacterial</li>
                        </ul>
                    </div>
                    
                    <div style="background: #fef3c7; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                        <p style="color: #92400e; font-weight: 600;">💡 When to be concerned:</p>
                        <ul style="margin-left: 20px; color: #92400e;">
                            <li>Fever above 100.4°F (38°C)</li>
                            <li>Fever with other symptoms</li>
                            <li>Fever lasting more than 24 hours</li>
                        </ul>
                    </div>
                    
                    <button class="btn btn-warning" onclick="reportSymptomToCareTeam('fever')" style="margin: 0;">
                        📞 Report Fever
                    </button>
                `
            },
            vision: {
                title: "Vision Changes",
                content: `
                    <div style="margin-bottom: 16px;">
                        <div style="background: #fee2e2; padding: 12px; border-radius: 8px; border-left: 4px solid #ef4444;">
                            <p style="color: #991b1b; font-weight: 700;">🚨 Vision changes may indicate ARIA</p>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #ef4444; margin-bottom: 8px;">⚠️ Concerning Visual Symptoms:</h4>
                        <ul style="margin-left: 20px; line-height: 1.6; color: #991b1b;">
                            <li>Blurred or double vision</li>
                            <li>Loss of visual field</li>
                            <li>Sudden vision loss</li>
                            <li>Seeing flashing lights or halos</li>
                        </ul>
                    </div>
                    
                    <div style="background: #fee2e2; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                        <p style="color: #991b1b; font-weight: 600;">🚨 SEEK IMMEDIATE MEDICAL ATTENTION</p>
                        <p style="color: #991b1b; font-size: 14px;">Vision changes require urgent evaluation, especially in combination with other neurological symptoms.</p>
                    </div>
                    
                    <button class="btn btn-danger" onclick="emergencyContact()" style="margin: 0;">
                        🚨 Emergency Contact
                    </button>
                `
            },
            breathing: {
                title: "Breathing Issues",
                content: `
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #ef4444; margin-bottom: 8px;">⚠️ Possible Causes:</h4>
                        <ul style="margin-left: 20px; line-height: 1.6;">
                            <li><strong>Allergic reaction</strong> - To infusion</li>
                            <li><strong>Anxiety</strong> - Related to treatment</li>
                            <li><strong>Other medical conditions</strong> - Unrelated to Lecanemab</li>
                        </ul>
                    </div>
                    
                    <div style="background: #fee2e2; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                        <p style="color: #991b1b; font-weight: 600;">🚨 Seek immediate care for:</p>
                        <ul style="margin-left: 20px; color: #991b1b;">
                            <li>Shortness of breath</li>
                            <li>Difficulty breathing</li>
                            <li>Chest tightness</li>
                            <li>Wheezing</li>
                        </ul>
                    </div>
                    
                    <button class="btn btn-danger" onclick="emergencyContact()" style="margin: 0;">
                        🚨 Emergency Contact
                    </button>
                `
            },
            fatigue: {
                title: "Fatigue",
                content: `
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #f59e0b; margin-bottom: 8px;">💡 Possible Causes:</h4>
                        <ul style="margin-left: 20px; line-height: 1.6;">
                            <li><strong>Treatment effect</strong> - Common after infusions</li>
                            <li><strong>Sleep disturbances</strong> - Related to condition or stress</li>
                            <li><strong>Other factors</strong> - Diet, exercise, medications</li>
                        </ul>
                    </div>
                    
                    <div style="background: #fef3c7; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                        <p style="color: #92400e; font-weight: 600;">💡 Management Tips:</p>
                        <ul style="margin-left: 20px; color: #92400e;">
                            <li>Ensure adequate rest and sleep</li>
                            <li>Light exercise as tolerated</li>
                            <li>Maintain good nutrition</li>
                            <li>Stay hydrated</li>
                        </ul>
                    </div>
                    
                    <p style="font-size: 14px; color: #64748b;">Contact your care team if fatigue is severe or persistent.</p>
                    
                    <button class="btn btn-warning" onclick="reportSymptomToCareTeam('fatigue')" style="margin: 0;">
                        📝 Report to Care Team
                    </button>
                `
            }
        };

        // Enhanced Error Handling
        function handleError(error, context = '') {
            console.error(`Error in ${context}:`, error);
            showNotification(`⚠️ Something went wrong. Please try again.`, 'error');
        }

        // Screen Navigation with Analytics
        function showScreen(screenNumber) {
            try {
                trackScreenVisit(screenNumber);
                
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const targetScreen = document.getElementById(`screen-${screenNumber}`);
                if (!targetScreen) {
                    throw new Error(`Screen ${screenNumber} not found`);
                }
                
                targetScreen.classList.add('active');
                
                const navItems = document.querySelectorAll('.nav-item');
                if (navItems[screenNumber - 1]) {
                    navItems[screenNumber - 1].classList.add('active');
                }
                
                AppState.currentScreen = screenNumber;
                initializeScreenFeatures(screenNumber);
            } catch (error) {
                handleError(error, 'showScreen');
            }
        }

        function trackScreenVisit(screenNumber) {
            const screenNames = ['', 'Assessment', 'Mood', 'Calendar', 'Progress', 'Education'];
            console.log(`Screen visited: ${screenNames[screenNumber]} at ${new Date().toISOString()}`);
        }

        function initializeScreenFeatures(screenNumber) {
            try {
                switch(screenNumber) {
                    case 2:
                        initializeMoodSelector();
                        break;
                    case 3:
                        updateCountdownTimer();
                        loadChecklistItems();
                        break;
                    case 4:
                        updateProgressCharts();
                        break;
                    case 5:
                        updateLearningProgress();
                        break;
                }
            } catch (error) {
                handleError(error, 'initializeScreenFeatures');
            }
        }

        // Mood Selector Functionality
        function initializeMoodSelector() {
            try {
                const moodDays = document.querySelectorAll('.mood-day');
                const moodEmojis = ['😞', '😔', '😐', '🙂', '😊'];
                
                moodDays.forEach((day, index) => {
                    const moodLevel = AppState.weeklyMood[index];
                    if (moodLevel !== null && moodLevel >= 0 && moodLevel < moodEmojis.length) {
                        const emoji = moodEmojis[moodLevel];
                        const emojiElement = day.querySelector('.mood-emoji');
                        if (emojiElement) {
                            emojiElement.textContent = emoji;
                        }
                        day.classList.add('selected');
                    }
                });
            } catch (error) {
                handleError(error, 'initializeMoodSelector');
            }
        }

        function selectMood(dayIndex) {
            try {
                const moodEmojis = ['😞', '😔', '😐', '🙂', '😊'];
                const currentMood = AppState.weeklyMood[dayIndex];
                const newMood = (currentMood + 1) % moodEmojis.length;
                
                AppState.weeklyMood[dayIndex] = newMood;
                
                const dayElement = document.querySelector(`[data-day="${dayIndex}"]`);
                const emojiElement = dayElement?.querySelector('.mood-emoji');
                
                if (emojiElement) {
                    emojiElement.textContent = moodEmojis[newMood];
                    dayElement.classList.add('selected');
                }
                
                showNotification(`Mood updated for day ${dayIndex + 1}`, 'success');
            } catch (error) {
                handleError(error, 'selectMood');
            }
        }

        // Symptom Tracking with Information Popups
        function toggleSymptom(element) {
            try {
                const symptom = element.dataset.symptom;
                
                if (element.classList.contains('selected')) {
                    element.classList.remove('selected');
                    AppState.selectedSymptoms = AppState.selectedSymptoms.filter(s => s !== symptom);
                    element.setAttribute('aria-pressed', 'false');
                } else {
                    element.classList.add('selected');
                    AppState.selectedSymptoms.push(symptom);
                    element.setAttribute('aria-pressed', 'true');
                    
                    // Show symptom information popup after a delay
                    setTimeout(() => {
                        showSymptomInfo(symptom);
                    }, 500);
                }
            } catch (error) {
                handleError(error, 'toggleSymptom');
            }
        }

        function showSymptomInfo(symptom) {
            try {
                if (symptomInfo[symptom]) {
                    const titleElement = document.getElementById('symptomInfoTitle');
                    const contentElement = document.getElementById('symptomInfoContent');
                    
                    if (titleElement && contentElement) {
                        titleElement.textContent = symptomInfo[symptom].title;
                        contentElement.innerHTML = symptomInfo[symptom].content;
                        document.getElementById('symptomInfoModal').classList.add('active');
                        
                        // Focus management for accessibility
                        setTimeout(() => {
                            const closeButton = document.querySelector('#symptomInfoModal .modal-close');
                            if (closeButton) closeButton.focus();
                        }, 100);
                    }
                }
            } catch (error) {
                handleError(error, 'showSymptomInfo');
            }
        }

        // Lifestyle Tracking
        function toggleLifestyle(element) {
            try {
                const activity = element.dataset.activity;
                
                if (element.classList.contains('completed')) {
                    element.classList.remove('completed');
                    AppState.lifestyleActivities[activity] = false;
                    element.setAttribute('aria-pressed', 'false');
                } else {
                    element.classList.add('completed');
                    AppState.lifestyleActivities[activity] = true;
                    element.setAttribute('aria-pressed', 'true');
                }
            } catch (error) {
                handleError(error, 'toggleLifestyle');
            }
        }

        // Submit Weekly Report with Enhanced Validation
        function submitWeeklyReport() {
            try {
                const moodCount = AppState.weeklyMood.filter(m => m !== null).length;
                const symptomCount = AppState.selectedSymptoms.length;
                
                if (moodCount < 7) {
                    showNotification('⚠️ Please complete your mood tracking for all 7 days.', 'warning');
                    return;
                }
                
                // Save current week's data
                AppState.addMoodEntry(new Date(), AppState.weeklyMood);
                AppState.addSymptomEntry(AppState.selectedSymptoms);
                AppState.addLifestyleEntry(AppState.lifestyleActivities);
                
                // Simulate AI analysis
                showNotification('🔄 Analyzing your weekly data with AI...', 'info');
                
                setTimeout(() => {
                    let analysisMessage = '✅ Weekly report submitted successfully!\n\n';
                    
                    // Provide personalized insights
                    const avgMood = AppState.weeklyMood.reduce((a, b) => a + b, 0) / 7;
                    if (avgMood >= 3.5) {
                        analysisMessage += '😊 Your mood this week was generally positive! ';
                    } else if (avgMood >= 2.5) {
                        analysisMessage += '😐 Your mood this week was stable. ';
                    } else {
                        analysisMessage += '😔 Your mood this week was lower than usual. ';
                    }
                    
                    if (symptomCount > 0) {
                        analysisMessage += `\n📊 ${symptomCount} symptoms reported. `;
                        const criticalSymptoms = AppState.selectedSymptoms.filter(s => 
                            ['confusion', 'vision', 'breathing'].includes(s)
                        );
                        
                        if (criticalSymptoms.length > 0) {
                            analysisMessage += 'Care team will be notified for urgent evaluation.';
                        } else {
                            analysisMessage += 'Symptoms will be reviewed by your care team.';
                        }
                    } else {
                        analysisMessage += '\n🎉 No symptoms reported this week!';
                    }
                    
                    // Check for correlations
                    const exerciseDays = Object.values(AppState.lifestyleActivities).filter(Boolean).length;
                    if (exerciseDays >= 5 && avgMood >= 3) {
                        analysisMessage += '\n\n💡 AI Insight: Your mood correlates positively with exercise days!';
                    }
                    
                    showNotification(analysisMessage, 'success');
                    resetWeeklyForm();
                    
                    // Switch to progress screen to show updated data
                    setTimeout(() => {
                        showScreen(4);
                    }, 3000);
                }, 2000);
            } catch (error) {
                handleError(error, 'submitWeeklyReport');
            }
        }

        function resetWeeklyForm() {
            try {
                // Reset symptoms
                document.querySelectorAll('.symptom-item').forEach(item => {
                    item.classList.remove('selected');
                    item.setAttribute('aria-pressed', 'false');
                });
                AppState.selectedSymptoms = [];
                
                // Reset lifestyle
                document.querySelectorAll('.lifestyle-item').forEach(item => {
                    item.classList.remove('completed');
                    item.setAttribute('aria-pressed', 'false');
                });
                AppState.lifestyleActivities = {
                    exercise: false,
                    sleep: false,
                    hydration: false,
                    nutrition: false
                };
            } catch (error) {
                handleError(error, 'resetWeeklyForm');
            }
        }

        // Enhanced Countdown Timer with Error Handling
        function updateCountdownTimer() {
            try {
                const countdownElement = document.getElementById('countdownTimer');
                if (!countdownElement) return;
                
                const now = new Date();
                const target = AppState.treatmentData.nextAppointment;
                const diff = target - now;
                
                if (diff > 0) {
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    
                    if (days > 0) {
                        countdownElement.textContent = `${days} days ${hours} hours`;
                    } else if (hours > 0) {
                        countdownElement.textContent = `${hours} hours ${minutes} minutes`;
                    } else {
                        countdownElement.textContent = `${minutes} minutes`;
                    }
                } else {
                    countdownElement.textContent = 'Appointment time!';
                    countdownElement.style.background = '#ef4444';
                }
            } catch (error) {
                handleError(error, 'updateCountdownTimer');
            }
        }

        // Smart Checklist Management
        function loadChecklistItems() {
            try {
                const checklistContainer = document.getElementById('checklistItems');
                if (!checklistContainer) return;
                
                const items = [
                    { text: 'Bring caregiver or support person', completed: true },
                    { text: 'Hydrate well (8+ glasses water)', completed: true },
                    { text: 'Prepare list of current symptoms', completed: true },
                    { text: 'Bring insurance card and ID', completed: true },
                    { text: 'Review ARIA warning signs', completed: true }
                ];
                
                checklistContainer.innerHTML = items.map(item => `
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <div style="width: 16px; height: 16px; background: ${item.completed ? '#10b981' : '#e2e8f0'}; border-radius: 4px; margin-right: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px;" aria-hidden="true">
                            ${item.completed ? '✓' : ''}
                        </div>
                        <span style="font-size: 14px; color: #374151; ${item.completed ? 'text-decoration: line-through; opacity: 0.7;' : ''}">${item.text}</span>
                    </div>
                `).join('');
            } catch (error) {
                handleError(error, 'loadChecklistItems');
            }
        }

        // Chart Updates with Error Handling
        function updateChart() {
            try {
                const timeframe = document.getElementById('chartTimeframe')?.value;
                if (timeframe) {
                    console.log(`Updating chart for timeframe: ${timeframe}`);
                    showNotification(`📊 Chart updated for ${timeframe}`, 'info');
                }
            } catch (error) {
                handleError(error, 'updateChart');
            }
        }

        // Enhanced Chart Updates with Interactive Features
        function updateProgressCharts() {
            try {
                // Cognitive Trends Chart
                const cognitiveData = AppState.cognitiveScores.history.map(entry => ({
                    label: new Date(entry.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                    value: entry.score
                }));
                
                const cognitiveChart = new InteractiveChart('cognitiveChart', cognitiveData, {
                    type: 'line',
                    width: 350,
                    height: 180
                });
                
                // Mood Trends Chart
                const moodData = AppState.getMoodTrend(14).map(entry => ({
                    label: new Date(entry.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                    value: entry.mood
                }));
                
                if (moodData.length > 0) {
                    const moodChart = new InteractiveChart('moodChart', moodData, {
                        type: 'line',
                        width: 350,
                        height: 180
                    });
                }
                
                // Update lifestyle statistics
                updateLifestyleStats();
                
            } catch (error) {
                handleError(error, 'updateProgressCharts');
            }
        }
        
        function updateLifestyleStats() {
            try {
                const stats = AppState.getLifestyleStats(7);
                const goalAchievement = {
                    exercise: Math.round((stats.exercise / AppState.goals.exercise) * 100),
                    sleep: Math.round((stats.sleep / 7) * 100),
                    hydration: Math.round((stats.hydration / 7) * 100),
                    nutrition: Math.round((stats.nutrition / 7) * 100)
                };
                
                // Update weekly report
                const reportItems = document.querySelectorAll('.report-item');
                if (reportItems.length >= 4) {
                    reportItems[0].innerHTML = `
                        <span>🏋️‍♀️ Exercise</span>
                        <span style="color: ${goalAchievement.exercise >= 80 ? '#10b981' : '#f59e0b'}; font-weight: 600;">
                            ${stats.exercise}/7 days
                        </span>
                    `;
                    reportItems[1].innerHTML = `
                        <span>😴 Good Sleep</span>
                        <span style="color: ${goalAchievement.sleep >= 80 ? '#10b981' : '#f59e0b'}; font-weight: 600;">
                            ${stats.sleep}/7 nights
                        </span>
                    `;
                    reportItems[2].innerHTML = `
                        <span>💧 Hydration</span>
                        <span style="color: ${goalAchievement.hydration >= 80 ? '#10b981' : '#f59e0b'}; font-weight: 600;">
                            ${stats.hydration}/7 days
                        </span>
                    `;
                    reportItems[3].innerHTML = `
                        <span>🥗 Healthy Diet</span>
                        <span style="color: ${goalAchievement.nutrition >= 80 ? '#10b981' : '#f59e0b'}; font-weight: 600;">
                            ${stats.nutrition}/7 days
                        </span>
                    `;
                }
                
                // Update overall score
                const overallScore = Math.round(Object.values(goalAchievement).reduce((a, b) => a + b, 0) / 4);
                const scoreElement = document.querySelector('.report-score');
                if (scoreElement) {
                    scoreElement.textContent = overallScore + '%';
                }
                
            } catch (error) {
                handleError(error, 'updateLifestyleStats');
            }
        }
        
        // Enhanced Lifestyle Tracking with Streaks
        function toggleDailyActivity(element) {
            try {
                const activity = element.dataset.activity;
                const isCompleted = element.classList.contains('completed');
                
                if (isCompleted) {
                    element.classList.remove('completed');
                    element.setAttribute('aria-pressed', 'false');
                    AppState.streaks[activity] = Math.max(0, AppState.streaks[activity] - 1);
                } else {
                    element.classList.add('completed');
                    element.setAttribute('aria-pressed', 'true');
                    AppState.streaks[activity] = (AppState.streaks[activity] || 0) + 1;
                    
                    // Show achievement notification for milestones
                    if (AppState.streaks[activity] % 7 === 0) {
                        showNotification(`🔥 ${AppState.streaks[activity]}-day streak for ${activity}! Amazing!`, 'success');
                    }
                }
                
                AppState.save();
                updateStreakDisplay();
                
            } catch (error) {
                handleError(error, 'toggleDailyActivity');
            }
        }
        
        function updateStreakDisplay() {
            try {
                const activities = ['exercise', 'meditation', 'hydration', 'social'];
                activities.forEach(activity => {
                    const element = document.querySelector(`[data-activity="${activity}"]`);
                    if (element && AppState.streaks[activity] > 0) {
                        const streakBadge = element.querySelector('.streak-badge') || document.createElement('div');
                        streakBadge.className = 'streak-badge';
                        streakBadge.style.cssText = `
                            position: absolute;
                            top: -8px;
                            right: -8px;
                            background: #ef4444;
                            color: white;
                            border-radius: 50%;
                            width: 20px;
                            height: 20px;
                            font-size: 10px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-weight: 700;
                        `;
                        streakBadge.textContent = AppState.streaks[activity];
                        
                        if (!element.querySelector('.streak-badge')) {
                            element.style.position = 'relative';
                            element.appendChild(streakBadge);
                        }
                    }
                });
            } catch (error) {
                handleError(error, 'updateStreakDisplay');
            }
        }
        
        // Enhanced Recipe System
        function openRecipe(recipeId) {
            try {
                const recipes = {
                    'mediterranean-bowl': {
                        title: 'Mediterranean Brain Bowl',
                        time: '25 minutes',
                        difficulty: 'Easy',
                        benefits: 'Rich in omega-3s, antioxidants, and brain-healthy nutrients',
                        ingredients: [
                            '2 cups mixed greens',
                            '1/2 cup cooked quinoa',
                            '1/4 cup walnuts',
                            '1/4 cup blueberries',
                            '2 oz grilled salmon',
                            '2 tbsp olive oil',
                            '1 tbsp lemon juice',
                            '1/4 avocado'
                        ],
                        instructions: [
                            'Cook quinoa according to package directions',
                            'Grill salmon with olive oil and lemon',
                            'Arrange greens in bowl',
                            'Top with quinoa, salmon, walnuts, and blueberries',
                            'Add sliced avocado',
                            'Drizzle with remaining olive oil and lemon'
                        ],
                        nutrition: {
                            calories: 485,
                            omega3: '1.2g',
                            antioxidants: 'High',
                            fiber: '8g'
                        }
                    },
                    'brain-smoothie': {
                        title: 'Blueberry Brain Boost Smoothie',
                        time: '5 minutes',
                        difficulty: 'Very Easy',
                        benefits: 'Packed with antioxidants and supports cognitive function',
                        ingredients: [
                            '1 cup frozen blueberries',
                            '1 banana',
                            '1/2 cup Greek yogurt',
                            '1 tbsp almond butter',
                            '1 tsp honey',
                            '1/2 cup almond milk',
                            '1 tsp chia seeds'
                        ],
                        instructions: [
                            'Add all ingredients to blender',
                            'Blend until smooth',
                            'Add more almond milk if needed',
                            'Pour into glass',
                            'Top with extra blueberries and chia seeds'
                        ],
                        nutrition: {
                            calories: 320,
                            antioxidants: 'Very High',
                            protein: '15g',
                            fiber: '8g'
                        }
                    },
                    'walnut-salmon': {
                        title: 'Walnut-Crusted Salmon',
                        time: '30 minutes',
                        difficulty: 'Medium',
                        benefits: 'High in DHA omega-3 fatty acids for brain health',
                        ingredients: [
                            '4 salmon fillets',
                            '1/2 cup chopped walnuts',
                            '2 tbsp breadcrumbs',
                            '1 tbsp honey',
                            '1 tbsp Dijon mustard',
                            '2 tbsp olive oil',
                            'Salt and pepper to taste'
                        ],
                        instructions: [
                            'Preheat oven to 400°F',
                            'Mix walnuts, breadcrumbs, honey, and mustard',
                            'Season salmon with salt and pepper',
                            'Press walnut mixture onto salmon',
                            'Drizzle with olive oil',
                            'Bake 15-20 minutes until cooked through'
                        ],
                        nutrition: {
                            calories: 420,
                            omega3: '2.1g',
                            protein: '35g',
                            fiber: '2g'
                        }
                    }
                };
                
                const recipe = recipes[recipeId];
                if (recipe) {
                    const modal = document.getElementById('recipeModal');
                    const title = document.getElementById('recipeModalTitle');
                    const content = document.getElementById('recipeContent');
                    
                    if (title && content) {
                        title.textContent = recipe.title;
                        content.innerHTML = `
                            <div style="margin-bottom: 20px;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                                    <div style="text-align: center; padding: 12px; background: #f0f9ff; border-radius: 8px;">
                                        <div style="font-size: 16px; font-weight: 700; color: #3b82f6;">⏱️</div>
                                        <div style="font-size: 12px; color: #64748b;">${recipe.time}</div>
                                    </div>
                                    <div style="text-align: center; padding: 12px; background: #f0fdf4; border-radius: 8px;">
                                        <div style="font-size: 16px; font-weight: 700; color: #10b981;">📊</div>
                                        <div style="font-size: 12px; color: #64748b;">${recipe.difficulty}</div>
                                    </div>
                                    <div style="text-align: center; padding: 12px; background: #fef3c7; border-radius: 8px;">
                                        <div style="font-size: 16px; font-weight: 700; color: #f59e0b;">🧠</div>
                                        <div style="font-size: 12px; color: #64748b;">Brain Food</div>
                                    </div>
                                </div>
                                
                                <div style="background: #f8fafc; padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                                    <h4 style="color: #1e293b; margin-bottom: 8px;">🌟 Health Benefits</h4>
                                    <p style="font-size: 14px; color: #64748b; line-height: 1.5;">${recipe.benefits}</p>
                                </div>
                                
                                <div style="margin-bottom: 20px;">
                                    <h4 style="color: #1e293b; margin-bottom: 12px;">🛒 Ingredients</h4>
                                    <ul style="margin-left: 20px; line-height: 1.6;">
                                        ${recipe.ingredients.map(ingredient => `<li style="margin-bottom: 4px;">${ingredient}</li>`).join('')}
                                    </ul>
                                </div>
                                
                                <div style="margin-bottom: 20px;">
                                    <h4 style="color: #1e293b; margin-bottom: 12px;">👩‍🍳 Instructions</h4>
                                    <ol style="margin-left: 20px; line-height: 1.6;">
                                        ${recipe.instructions.map(step => `<li style="margin-bottom: 8px;">${step}</li>`).join('')}
                                    </ol>
                                </div>
                                
                                <div style="background: #f0f9ff; padding: 16px; border-radius: 12px;">
                                    <h4 style="color: #1e293b; margin-bottom: 12px;">📊 Nutrition Highlights</h4>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                                        ${Object.entries(recipe.nutrition).map(([key, value]) => `
                                            <div style="font-size: 14px;">
                                                <span style="color: #64748b; text-transform: capitalize;">${key}:</span>
                                                <span style="font-weight: 600; color: #1e293b;">${value}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <div style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                    <button class="btn btn-secondary" onclick="saveRecipe('${recipeId}')" style="margin: 0;">
                                        ❤️ Save Recipe
                                    </button>
                                    <button class="btn btn-primary" onclick="shareRecipe('${recipeId}')" style="margin: 0;">
                                        📤 Share Recipe
                                    </button>
                                </div>
                            </div>
                        `;
                        
                        modal.classList.add('active');
                    }
                }
            } catch (error) {
                handleError(error, 'openRecipe');
            }
        }
        
        function saveRecipe(recipeId) {
            showNotification('❤️ Recipe saved to your favorites!', 'success');
            closeModal('recipeModal');
        }
        
        function shareRecipe(recipeId) {
            showNotification('📤 Recipe link copied to clipboard!', 'success');
            closeModal('recipeModal');
        }
        
        // Enhanced Exercise Program System
        function startExerciseProgram(programId) {
            try {
                const programs = {
                    'gentle-yoga': {
                        title: 'Gentle Yoga for Brain Health',
                        duration: '15 minutes',
                        exercises: [
                            { name: 'Deep Breathing', duration: '2 min', description: 'Focus on breath to increase oxygen flow' },
                            { name: 'Cat-Cow Pose', duration: '3 min', description: 'Gentle spinal movement' },
                            { name: 'Tree Pose', duration: '2 min', description: 'Balance and focus exercise' },
                            { name: 'Seated Twist', duration: '3 min', description: 'Improve spinal mobility' },
                            { name: 'Meditation', duration: '5 min', description: 'Mindfulness practice' }
                        ]
                    },
                    'brain-walk': {
                        title: 'Brain-Boosting Walk',
                        duration: '30 minutes',
                        exercises: [
                            { name: 'Warm-up', duration: '5 min', description: 'Gentle walking pace' },
                            { name: 'Counting Walk', duration: '5 min', description: 'Count backward from 100 by 7s' },
                            { name: 'Observation Walk', duration: '5 min', description: 'Name 5 things you see, 4 you hear, 3 you feel' },
                            { name: 'Brisk Walk', duration: '10 min', description: 'Moderate intensity walking' },
                            { name: 'Cool Down', duration: '5 min', description: 'Slow walking with deep breathing' }
                        ]
                    }
                };
                
                const program = programs[programId];
                if (program) {
                    showExerciseProgram(program);
                }
            } catch (error) {
                handleError(error, 'startExerciseProgram');
            }
        }
        
        function showExerciseProgram(program) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <button class="modal-close" onclick="this.closest('.modal').remove()" aria-label="Close modal">&times;</button>
                    <h2 style="margin-bottom: 20px; color: #1e293b;">${program.title}</h2>
                    
                    <div style="background: #f0f9ff; padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                        <div style="font-size: 16px; font-weight: 700; color: #3b82f6;">Duration: ${program.duration}</div>
                        <div style="font-size: 14px; color: #64748b; margin-top: 4px;">Follow along at your own pace</div>
                    </div>
                    
                    <div id="exerciseList" style="margin-bottom: 20px;">
                        ${program.exercises.map((exercise, index) => `
                            <div class="exercise-item" style="display: flex; align-items: center; padding: 12px; background: #f8fafc; border-radius: 8px; margin-bottom: 8px; cursor: pointer;" data-exercise="${index}">
                                <div style="width: 32px; height: 32px; background: #e2e8f0; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-weight: 700; color: #64748b;">
                                    ${index + 1}
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: #1e293b;">${exercise.name}</div>
                                    <div style="font-size: 12px; color: #64748b;">${exercise.description}</div>
                                </div>
                                <div style="font-size: 14px; font-weight: 600; color: #3b82f6;">${exercise.duration}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()" style="margin: 0;">
                            📋 Save for Later
                        </button>
                        <button class="btn btn-primary" onclick="startExerciseTimer('${program.title}'); this.closest('.modal').remove();" style="margin: 0;">
                            ▶️ Start Program
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function startExerciseTimer(programTitle) {
            showNotification(`🏃‍♀️ Starting ${programTitle}! Follow the guided exercises.`, 'success');
            
            // Simulate exercise completion after 30 seconds (for demo)
            setTimeout(() => {
                showNotification('🎉 Exercise program completed! Great job!', 'success');
                AppState.streaks.exercise = (AppState.streaks.exercise || 0) + 1;
                AppState.save();
                updateStreakDisplay();
            }, 30000);
        }

        function playInteractiveVideo(videoType) {
            try {
                document.getElementById('videoModal').classList.add('active');
                
                // Focus management for accessibility
                setTimeout(() => {
                    const closeButton = document.querySelector('#videoModal .modal-close');
                    if (closeButton) closeButton.focus();
                }, 100);
            } catch (error) {
                handleError(error, 'playInteractiveVideo');
            }
        }

        function completeVideo() {
            try {
                showNotification('🎉 Video completed! Knowledge points earned.', 'success');
                closeModal('videoModal');
            } catch (error) {
                handleError(error, 'completeVideo');
            }
        }

        function openReference(type) {
            try {
                const referenceInfo = {
                    'medication-guide': 'Opening Lecanemab medication guide...',
                    'emergency-contacts': 'Opening emergency contact information...',
                    'aria-info': 'Opening ARIA monitoring guidelines...'
                };
                
                const message = referenceInfo[type] || 'Opening reference material...';
                showNotification(`📚 ${message}`, 'info');
            } catch (error) {
                handleError(error, 'openReference');
            }
        }

        // Modal Management with Improved Accessibility
        function showAppointmentModal() {
            try {
                document.getElementById('appointmentModal').classList.add('active');
                
                // Focus management for accessibility
                setTimeout(() => {
                    const firstInput = document.querySelector('#appointmentModal input, #appointmentModal select');
                    if (firstInput) firstInput.focus();
                }, 100);
            } catch (error) {
                handleError(error, 'showAppointmentModal');
            }
        }

        function closeModal(modalId) {
            try {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('active');
                }
            } catch (error) {
                handleError(error, 'closeModal');
            }
        }

        function scheduleAppointment() {
            try {
                showNotification('📅 Appointment request sent! You\'ll receive confirmation within 24 hours.', 'success');
                closeModal('appointmentModal');
            } catch (error) {
                handleError(error, 'scheduleAppointment');
            }
        }

        // Smart Features
        function addToCalendar() {
            try {
                showNotification('📱 Adding appointment to your device calendar...', 'info');
                setTimeout(() => {
                    showNotification('✅ Appointment added to calendar with ARIA monitoring reminder!', 'success');
                }, 1500);
            } catch (error) {
                handleError(error, 'addToCalendar');
            }
        }

        function getDirections() {
            try {
                showNotification('🗺️ Opening navigation to Mayo Clinic...', 'info');
                setTimeout(() => {
                    showNotification('📍 Live traffic updates: Expect 25-minute drive time', 'info');
                }, 1000);
            } catch (error) {
                handleError(error, 'getDirections');
            }
        }

        function shareProgress() {
            try {
                showNotification('📤 Generating secure report for your care team...', 'info');
                setTimeout(() => {
                    showNotification('✅ Progress report shared with Dr. Martinez', 'success');
                }, 2000);
            } catch (error) {
                handleError(error, 'shareProgress');
            }
        }

        function exportDetailedReport() {
            try {
                showNotification('📊 Preparing comprehensive analytics report...', 'info');
                setTimeout(() => {
                    showNotification('📄 Detailed report exported! Check your downloads.', 'success');
                }, 2500);
            } catch (error) {
                handleError(error, 'exportDetailedReport');
            }
        }

        // Assessment Features
        function startQuickAssessment() {
            try {
                showNotification('🚀 Launching quick cognitive assessment...', 'info');
                setTimeout(() => {
                    showNotification('🧠 Assessment started! Follow the on-screen instructions.', 'info');
                    setTimeout(() => {
                        showNotification('✅ Assessment complete! Score: 72% (+2% improvement)', 'success');
                        updateScoreDisplay(72);
                    }, 5000);
                }, 1500);
            } catch (error) {
                handleError(error, 'startQuickAssessment');
            }
        }

        function startComprehensiveTest() {
            try {
                showNotification('🧩 Connecting to comprehensive cognitive battery...', 'info');
                setTimeout(() => {
                    showNotification('🔗 Redirecting to detailed assessment platform...', 'info');
                }, 1500);
            } catch (error) {
                handleError(error, 'startComprehensiveTest');
            }
        }

        function updateScoreDisplay(newScore) {
            try {
                const scoreElement = document.querySelector('.progress-ring-inner .metric-value');
                if (scoreElement) {
                    scoreElement.style.color = '#10b981';
                    setTimeout(() => {
                        scoreElement.textContent = newScore + '%';
                    }, 500);
                }
            } catch (error) {
                handleError(error, 'updateScoreDisplay');
            }
        }

        // Emergency and Care Team Functions
        function emergencyContact() {
            try {
                const confirmEmergency = confirm(`🚨 EMERGENCY CONTACT\n\nThis will immediately connect you with:\n\n• 24/7 Lecanemab Support: (555) 123-4567\n• Emergency Services: 911\n• Dr. Martinez's office: (555) 987-6543\n\nIMPORTANT: If experiencing ARIA symptoms (confusion, vision changes, severe headache), call immediately.\n\nProceed?`);
                
                if (confirmEmergency) {
                    showNotification('🚨 Connecting to emergency support...', 'error');
                    setTimeout(() => {
                        alert('📞 Emergency contact initiated. A nurse will call you within 2 minutes.\n\n🏥 If this is a life-threatening emergency, call 911 immediately.');
                    }, 1500);
                }
            } catch (error) {
                handleError(error, 'emergencyContact');
            }
        }

        function reportSymptomToCareTeam(symptom) {
            try {
                showNotification(`📝 Reporting ${symptom} to your care team...`, 'info');
                setTimeout(() => {
                    showNotification('✅ Symptom reported. Care team will contact you within 4 hours.', 'success');
                    closeModal('symptomInfoModal');
                }, 1500);
            } catch (error) {
                handleError(error, 'reportSymptomToCareTeam');
            }
        }

        // Enhanced Notification System
        function showNotification(message, type = 'info') {
            try {
                const notification = document.getElementById('notification');
                const content = document.getElementById('notificationContent');
                
                if (!notification || !content) return;
                
                const icons = {
                    'info': 'ℹ️',
                    'success': '✅',
                    'warning': '⚠️',
                    'error': '❌'
                };
                
                const colors = {
                    'info': '#3b82f6',
                    'success': '#10b981',
                    'warning': '#f59e0b',
                    'error': '#ef4444'
                };
                
                content.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <span style="margin-right: 8px; font-size: 16px;" aria-hidden="true">${icons[type]}</span>
                        <span style="font-size: 14px; color: ${colors[type]}; font-weight: 600;">${message}</span>
                    </div>
                `;
                
                notification.style.display = 'block';
                
                // Auto-hide notification
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 5000);
            } catch (error) {
                console.error('Error showing notification:', error);
            }
        }

        // Personalized Greeting Function
        function getPersonalizedGreeting() {
            const hour = new Date().getHours();
            const greetings = {
                morning: '🌅 Good morning! Ready for your brain health check-in?',
                afternoon: '☀️ Good afternoon! How are you feeling today?',
                evening: '🌙 Good evening! Time to review your day.'
            };
            
            if (hour < 12) return greetings.morning;
            if (hour < 17) return greetings.afternoon;
            return greetings.evening;
        }

        // Guided Tour Function
        function startGuidedTour() {
            try {
                let currentStep = 0;
                const tourSteps = [
                    { screen: 1, message: '🧠 Enhanced brain assessments with AI insights and progress tracking' },
                    { screen: 2, message: '😊 New: 7-day mood tracking and symptom monitoring with ARIA alerts' },
                    { screen: 3, message: '📅 Smart calendar with travel assistance and ARIA monitoring reminders' },
                    { screen: 4, message: '📈 Advanced analytics with mood trends and lifestyle reports' },
                    { screen: 5, message: '🎓 Enhanced learning center with ARIA education and safety information' }
                ];
                
                function nextStep() {
                    if (currentStep < tourSteps.length) {
                        const step = tourSteps[currentStep];
                        showScreen(step.screen);
                        setTimeout(() => {
                            if (confirm(step.message + '\n\nContinue tour?')) {
                                currentStep++;
                                nextStep();
                            }
                        }, 1000);
                    } else {
                        showNotification('🎉 Tour complete! Your enhanced companion app is ready.', 'success');
                    }
                }
                
                nextStep();
            } catch (error) {
                handleError(error, 'startGuidedTour');
            }
        }

        // App Initialization
        function initializeApp() {
            try {
                console.log('🚀 Enhanced Lecanemab Digital Companion initialized');
                
                // Load saved data
                AppState.load();
                
                // Initialize medication reminder system
                const medicationReminder = new MedicationReminder();
                
                // Set up real-time updates
                setInterval(updateCountdownTimer, 60000); // Update every minute
                
                // Initialize first screen
                initializeScreenFeatures(1);
                
                // Update streak displays
                updateStreakDisplay();
                
                // Add button interactions with haptic feedback simulation
                document.querySelectorAll('.btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        this.style.transform = 'scale(0.98)';
                        // Simulate haptic feedback
                        if (navigator.vibrate) {
                            navigator.vibrate(50);
                        }
                        setTimeout(() => {
                            this.style.transform = '';
                        }, 150);
                    });
                });

                // Add aria-pressed attributes to interactive elements
                document.querySelectorAll('.symptom-item, .lifestyle-item, .mood-day').forEach(item => {
                    item.setAttribute('aria-pressed', 'false');
                    item.setAttribute('tabindex', '0');
                });

                // Add keyboard navigation
                document.addEventListener('keydown', handleKeyboardNavigation);

                // Add click-outside-to-close for modals
                document.addEventListener('click', handleModalClickOutside);
                
                // Initialize charts if on progress screen
                if (AppState.currentScreen === 4) {
                    setTimeout(updateProgressCharts, 500);
                }
                
                // Show personalized greeting
                setTimeout(() => {
                    const greeting = getPersonalizedGreeting();
                    showNotification(greeting, 'info');
                }, 1000);
                
                // Show ARIA awareness reminder (every app start)
                setTimeout(() => {
                    if (Math.random() < 0.3) { // 30% chance to show reminder
                        showNotification('🧠 Remember: Report any confusion, vision changes, or severe headaches immediately to your care team.', 'warning');
                    }
                }, 8000);

                // Check for milestone achievements
                checkAchievements();
                
                // Set up auto-save
                setInterval(() => {
                    AppState.save();
                }, 30000); // Auto-save every 30 seconds

                // Show welcome message with tour option (only on first use)
                const isFirstTime = !localStorage.getItem('lecanemabAppVisited');
                if (isFirstTime) {
                    localStorage.setItem('lecanemabAppVisited', 'true');
                    setTimeout(() => {
                        const welcomeMessage = `🎉 Welcome to the Enhanced Lecanemab Digital Companion!\n\nNew Features:\n• 📊 Interactive charts with real-time data visualization\n• 💊 Smart medication reminders with pre-infusion checklists\n• 🔥 Activity streaks and achievement system\n• 📅 7-day mood tracking with trend analysis\n• ⚠️ Enhanced symptom monitoring with ARIA alerts\n• 🏃‍♀️ Guided exercise programs and brain-healthy recipes\n• 💾 Automatic data persistence\n• 🚨 Enhanced emergency contact system\n\nBased on FDA-approved Lecanemab prescribing information.`;
                        
                        if (confirm(welcomeMessage + '\n\nWould you like a guided tour?')) {
                            startGuidedTour();
                        }
                    }, 2000);
                }

            } catch (error) {
                handleError(error, 'initializeApp');
            }
        }
        
        // Achievement System
        function checkAchievements() {
            try {
                const achievements = [];
                
                // Check streak achievements
                Object.entries(AppState.streaks).forEach(([activity, streak]) => {
                    if (streak === 7) {
                        achievements.push(`🏆 Week Warrior: 7-day ${activity} streak!`);
                    } else if (streak === 30) {
                        achievements.push(`🌟 Monthly Master: 30-day ${activity} streak!`);
                    }
                });
                
                // Check cognitive improvement
                if (AppState.cognitiveScores.current > AppState.cognitiveScores.baseline + 10) {
                    achievements.push('🧠 Cognitive Champion: 10+ point improvement!');
                }
                
                // Check consistent mood tracking
                if (AppState.moodHistory.length >= 30) {
                    achievements.push('📊 Data Detective: 30 days of mood tracking!');
                }
                
                // Show achievements
                achievements.forEach((achievement, index) => {
                    setTimeout(() => {
                        showNotification(achievement, 'success');
                    }, index * 2000);
                });
                
            } catch (error) {
                handleError(error, 'checkAchievements');
            }
        }

        // Enhanced Keyboard Navigation
        function handleKeyboardNavigation(e) {
            try {
                // Alt + number keys for screen navigation
                if (e.altKey && e.key >= '1' && e.key <= '5') {
                    e.preventDefault();
                    showScreen(parseInt(e.key));
                }
                
                // Alt + E for emergency contact
                if (e.altKey && e.key.toLowerCase() === 'e') {
                    e.preventDefault();
                    emergencyContact();
                }

                // Escape key to close modals
                if (e.key === 'Escape') {
                    const activeModal = document.querySelector('.modal.active');
                    if (activeModal) {
                        closeModal(activeModal.id);
                    }
                }

                // Enter/Space for interactive elements
                if ((e.key === 'Enter' || e.key === ' ') && e.target.classList.contains('symptom-item', 'lifestyle-item', 'mood-day')) {
                    e.preventDefault();
                    e.target.click();
                }
            } catch (error) {
                handleError(error, 'handleKeyboardNavigation');
            }
        }

        // Click Outside Modal to Close
        function handleModalClickOutside(e) {
            try {
                if (e.target.classList.contains('modal')) {
                    closeModal(e.target.id);
                }
            } catch (error) {
                handleError(error, 'handleModalClickOutside');
            }
        }

        // Enhanced Focus Management
        function trapFocus(element) {
            const focusableElements = element.querySelectorAll(
                'a[href], button, textarea, input[type="text"], input[type="radio"], input[type="checkbox"], select'
            );
            const firstFocusableElement = focusableElements[0];
            const lastFocusableElement = focusableElements[focusableElements.length - 1];

            element.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstFocusableElement) {
                            lastFocusableElement.focus();
                            e.preventDefault();
                        }
                    } else {
                        if (document.activeElement === lastFocusableElement) {
                            firstFocusableElement.focus();
                            e.preventDefault();
                        }
                    }
                }
            });
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            
            // Set up focus trapping for modals
            document.querySelectorAll('.modal').forEach(modal => {
                trapFocus(modal);
            });
        });

        // Service Worker Registration (for offline functionality)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Prevent zoom on double-tap (mobile)
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Handle viewport changes (mobile keyboard)
        function handleViewportChange() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }

        window.addEventListener('resize', handleViewportChange);
        window.addEventListener('orientationchange', handleViewportChange);
        handleViewportChange();

        // Interactive Chart System
        class InteractiveChart {
            constructor(containerId, data, options = {}) {
                this.container = document.getElementById(containerId);
                this.data = data;
                this.options = {
                    width: 350,
                    height: 200,
                    margin: { top: 20, right: 20, bottom: 30, left: 40 },
                    ...options
                };
                this.render();
            }
            
            render() {
                if (!this.container) return;
                
                const { width, height, margin } = this.options;
                const innerWidth = width - margin.left - margin.right;
                const innerHeight = height - margin.top - margin.bottom;
                
                // Clear container
                this.container.innerHTML = '';
                
                // Create SVG
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('width', width);
                svg.setAttribute('height', height);
                svg.style.background = 'white';
                svg.style.borderRadius = '12px';
                
                // Create chart based on type
                if (this.options.type === 'line') {
                    this.renderLineChart(svg, innerWidth, innerHeight);
                } else if (this.options.type === 'bar') {
                    this.renderBarChart(svg, innerWidth, innerHeight);
                }
                
                this.container.appendChild(svg);
                
                // Add interactivity
                this.addInteractivity(svg);
            }
            
            renderLineChart(svg, width, height) {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                g.setAttribute('transform', `translate(${this.options.margin.left},${this.options.margin.top})`);
                
                // Scales
                const xScale = (i) => (i / (this.data.length - 1)) * width;
                const yScale = (value) => height - ((value - Math.min(...this.data.map(d => d.value))) / 
                    (Math.max(...this.data.map(d => d.value)) - Math.min(...this.data.map(d => d.value)))) * height;
                
                // Create path
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const pathData = this.data.map((d, i) => 
                    `${i === 0 ? 'M' : 'L'} ${xScale(i)} ${yScale(d.value)}`
                ).join(' ');
                
                path.setAttribute('d', pathData);
                path.setAttribute('fill', 'none');
                path.setAttribute('stroke', '#3b82f6');
                path.setAttribute('stroke-width', '3');
                path.style.filter = 'drop-shadow(0 2px 4px rgba(59, 130, 246, 0.3))';
                
                // Add gradient area
                const area = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const areaData = pathData + ` L ${xScale(this.data.length - 1)} ${height} L ${xScale(0)} ${height} Z`;
                area.setAttribute('d', areaData);
                area.setAttribute('fill', 'url(#gradient)');
                area.setAttribute('opacity', '0.3');
                
                // Create gradient
                const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
                const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
                gradient.setAttribute('id', 'gradient');
                gradient.setAttribute('x1', '0%');
                gradient.setAttribute('y1', '0%');
                gradient.setAttribute('x2', '0%');
                gradient.setAttribute('y2', '100%');
                
                const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
                stop1.setAttribute('offset', '0%');
                stop1.setAttribute('stop-color', '#3b82f6');
                stop1.setAttribute('stop-opacity', '0.6');
                
                const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
                stop2.setAttribute('offset', '100%');
                stop2.setAttribute('stop-color', '#3b82f6');
                stop2.setAttribute('stop-opacity', '0');
                
                gradient.appendChild(stop1);
                gradient.appendChild(stop2);
                defs.appendChild(gradient);
                svg.appendChild(defs);
                
                g.appendChild(area);
                g.appendChild(path);
                
                // Add data points
                this.data.forEach((d, i) => {
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', xScale(i));
                    circle.setAttribute('cy', yScale(d.value));
                    circle.setAttribute('r', '4');
                    circle.setAttribute('fill', '#3b82f6');
                    circle.setAttribute('stroke', 'white');
                    circle.setAttribute('stroke-width', '2');
                    circle.style.cursor = 'pointer';
                    circle.setAttribute('data-value', d.value);
                    circle.setAttribute('data-label', d.label);
                    
                    // Hover effect
                    circle.addEventListener('mouseenter', (e) => {
                        circle.setAttribute('r', '6');
                        showTooltip(e, d.label, d.value);
                    });
                    
                    circle.addEventListener('mouseleave', () => {
                        circle.setAttribute('r', '4');
                        hideTooltip();
                    });
                    
                    g.appendChild(circle);
                });
                
                svg.appendChild(g);
            }
            
            addInteractivity(svg) {
                svg.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const rect = svg.getBoundingClientRect();
                    const x = touch.clientX - rect.left;
                    const y = touch.clientY - rect.top;
                    
                    // Find nearest data point
                    const nearestPoint = this.findNearestPoint(x, y);
                    if (nearestPoint) {
                        this.highlightPoint(nearestPoint);
                    }
                });
            }
            
            findNearestPoint(x, y) {
                // Implementation for finding nearest data point
                return null;
            }
            
            highlightPoint(point) {
                // Implementation for highlighting a point
            }
        }
        
        // Tooltip functions
        function showTooltip(event, label, value) {
            let tooltip = document.getElementById('chartTooltip');
            if (!tooltip) {
                tooltip = document.createElement('div');
                tooltip.id = 'chartTooltip';
                tooltip.style.cssText = `
                    position: absolute;
                    background: rgba(0, 0, 0, 0.9);
                    color: white;
                    padding: 8px 12px;
                    border-radius: 6px;
                    font-size: 12px;
                    font-weight: 600;
                    pointer-events: none;
                    z-index: 1000;
                    opacity: 0;
                    transition: opacity 0.2s;
                `;
                document.body.appendChild(tooltip);
            }
            
            tooltip.innerHTML = `${label}: ${value}${typeof value === 'number' ? '%' : ''}`;
            tooltip.style.left = event.pageX + 10 + 'px';
            tooltip.style.top = event.pageY - 30 + 'px';
            tooltip.style.opacity = '1';
        }
        
        function hideTooltip() {
            const tooltip = document.getElementById('chartTooltip');
            if (tooltip) {
                tooltip.style.opacity = '0';
            }
        }
        
        // Medication Reminder System
        class MedicationReminder {
            constructor() {
                this.reminders = AppState.treatmentData.medications || [];
                this.checkInterval = null;
                this.init();
            }
            
            init() {
                this.startChecking();
                this.createReminderUI();
            }
            
            startChecking() {
                // Check every minute for due medications
                this.checkInterval = setInterval(() => {
                    this.checkDueMedications();
                }, 60000);
                
                // Initial check
                this.checkDueMedications();
            }
            
            checkDueMedications() {
                const now = new Date();
                this.reminders.forEach(medication => {
                    const timeDiff = medication.nextDue - now;
                    const hoursUntilDue = timeDiff / (1000 * 60 * 60);
                    
                    // Remind 24 hours before
                    if (hoursUntilDue <= 24 && hoursUntilDue > 23) {
                        this.showReminder(medication, '24 hours');
                    }
                    // Remind 1 hour before
                    else if (hoursUntilDue <= 1 && hoursUntilDue > 0) {
                        this.showReminder(medication, '1 hour');
                    }
                    // Medication is due now
                    else if (hoursUntilDue <= 0 && hoursUntilDue > -1) {
                        this.showReminder(medication, 'now');
                    }
                });
            }
            
            showReminder(medication, timeframe) {
                const message = timeframe === 'now' 
                    ? `💊 Your ${medication.name} infusion is scheduled now!`
                    : `💊 Reminder: ${medication.name} infusion in ${timeframe}`;
                
                showNotification(message, timeframe === 'now' ? 'warning' : 'info');
                
                // Show medication reminder modal for immediate reminders
                if (timeframe === 'now' || timeframe === '1 hour') {
                    this.showMedicationModal(medication, timeframe);
                }
            }
            
            showMedicationModal(medication, timeframe) {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 48px; margin-bottom: 16px;">💊</div>
                            <h2 style="margin-bottom: 16px; color: #1e293b;">Medication Reminder</h2>
                            <div style="background: ${timeframe === 'now' ? '#fee2e2' : '#fef3c7'}; padding: 16px; border-radius: 12px; margin-bottom: 16px;">
                                <div style="font-weight: 700; color: ${timeframe === 'now' ? '#991b1b' : '#92400e'};">
                                    ${medication.name} - ${medication.dose}
                                </div>
                                <div style="font-size: 14px; color: ${timeframe === 'now' ? '#7f1d1d' : '#78350f'}; margin-top: 4px;">
                                    ${timeframe === 'now' ? 'Scheduled now' : `Due in ${timeframe}`}
                                </div>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <div style="font-size: 14px; color: #64748b; line-height: 1.5;">
                                    <strong>Pre-infusion checklist:</strong><br>
                                    • Hydrate well (8+ glasses water)<br>
                                    • Bring caregiver or support person<br>
                                    • Review ARIA warning signs<br>
                                    • Prepare symptom updates for care team
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                                    ⏰ Remind Later
                                </button>
                                <button class="btn btn-primary" onclick="medicationTaken('${medication.name}'); this.closest('.modal').remove();">
                                    ✅ Mark Complete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Auto-remove after 30 seconds if no action
                setTimeout(() => {
                    if (modal.parentNode) {
                        modal.remove();
                    }
                }, 30000);
            }
            
            createReminderUI() {
                // Add medication status to main screens
                this.updateMedicationStatus();
            }
            
            updateMedicationStatus() {
                // Update medication status indicators throughout the app
                const statusElements = document.querySelectorAll('.medication-status');
                statusElements.forEach(element => {
                    element.innerHTML = this.getMedicationStatusHTML();
                });
            }
            
            getMedicationStatusHTML() {
                const nextMed = this.reminders[0];
                if (!nextMed) return '';
                
                const now = new Date();
                const timeDiff = nextMed.nextDue - now;
                const daysUntil = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                
                return `
                    <div style="display: flex; align-items: center; padding: 12px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                        <div style="margin-right: 12px; font-size: 20px;">💊</div>
                        <div>
                            <div style="font-size: 14px; font-weight: 600; color: #0c4a6e;">Next: ${nextMed.name}</div>
                            <div style="font-size: 12px; color: #075985;">${daysUntil > 0 ? `In ${daysUntil} days` : 'Today'}</div>
                        </div>
                    </div>
                `;
            }
        }
        
        function medicationTaken(medicationName) {
            showNotification(`✅ ${medicationName} marked as completed!`, 'success');
            // Update next due date (in real app, this would sync with backend)
            const medication = AppState.treatmentData.medications.find(m => m.name === medicationName);
            if (medication) {
                medication.nextDue = new Date(medication.nextDue.getTime() + 14 * 24 * 60 * 60 * 1000); // Add 2 weeks
                AppState.save();
            }
        }
    </script>
</body>
</html>
